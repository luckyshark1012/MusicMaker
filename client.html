<!DOCTYPE html>
<html>
<head>
    <title>Music Player Client</title>
    <script src="https://cdn.jsdelivr.net/npm/tone@14.8.1/build/Tone.min.js"></script>

</head>
<body>
    <h1>WebSocket Music Player</h1>
    <p>Connecting to the server and playing music...</p>
    <input type="range" min="0" max="100" value="50" id="volumeSlider">
    <button id="playButton">Play</button>
    <button id="pauseButton">Pause</button>

    <script>
function createKick() {
    const kick = new Tone.MembraneSynth({
        pitchDecay: 0.008,
        octaves: 6,
        oscillator: { type: 'sine' },
        envelope: { attack: 0.001, decay: 0.5, sustain: 0, release: 1 }
    }).toDestination();

    return () => {
        kick.triggerAttackRelease("C1", "8n");
    };
}

function createSnare() {
    const snare = new Tone.NoiseSynth({
        noise: { type: 'white' },
        envelope: { attack: 0.005, decay: 0.2, sustain: 0, release: 0.1 },
        volume: -8
    }).toDestination();

    return () => {
        snare.triggerAttackRelease("16n");
    };
}

function createHiHat() {
    const hiHat = new Tone.MetalSynth({
        frequency: 250,
        envelope: { attack: 0.005, decay: 0.1, release: 0.01 },
        harmonicity: 5.1,
        modulationIndex: 32,
        resonance: 8000,
        octaves: 1
    }).toDestination();

    return () => {
        hiHat.triggerAttackRelease("32n");
    };
}

function createBass() {
    const bass = new Tone.Synth({
        oscillator: { type: 'sine' },
        envelope: { attack: 0.01, decay: 0.6, sustain: 0.5, release: 2 }
    }).toDestination();

    return (note, time) => {
        bass.triggerAttackRelease(note, '8n', time);
    };
}

function createGuitar() {
    const guitar = new Tone.PolySynth(Tone.FMSynth, {
        harmonicity: 3.01,
        modulationIndex: 14,
        oscillator: { type: 'triangle' },
        envelope: { attack: 0.001, decay: 0.4, sustain: 0.01, release: 1.4 },
        modulation: { type: 'square' },
        modulationEnvelope: { attack: 0.002, decay: 0.2, sustain: 0, release: 0.2 }
    }).toDestination();

    return (note, time) => {
        guitar.triggerAttackRelease(note, '8n', time);
    };
}

function createPiano() {
    const piano = new Tone.PolySynth(Tone.Synth, {
        oscillator: { type: 'sine' },
        envelope: { attack: 0.005, decay: 0.3, sustain: 0.6, release: 1 }
    }).toDestination();

    return (note, time) => {
        piano.triggerAttackRelease(note, '8n', time);
    };
}

document.addEventListener('DOMContentLoaded', function() {
    const playButton = document.getElementById('playButton');
    playButton.addEventListener('click', () => {
        Tone.start()
            .then(() => {
                console.log('Audio context started');
                initializeAudio();
            })
            .catch(e => console.error(e));
    });
});

function initializeAudio() {
    const ws = new WebSocket('ws://localhost:8080');

    // Define synthesizers for each instrument
    const synthKick = createKick();
    const synthSnare = createSnare();
    const synthHiHat = createHiHat();
    const synthBass = createBass();
    const synthGuitar = createGuitar();
    const synthPiano = createPiano();

    ws.onmessage = function(event) {
        const bundle = JSON.parse(event.data);

        for (const instrument in bundle) {
            const note = bundle[instrument];
            if (note) {
                playInstrument(instrument, note);
            }
        }
    };

    function playInstrument(instrument, note) {
        const now = Tone.now();
        switch (instrument) {
            case 'hihat':
                synthHiHat(note, now);
                break;
            case 'kick':
                synthKick(note, now);
                break;
            case 'snare':
                synthSnare(note, now);
                break;
            case 'bass':
                synthBass(note, now);
                break;
            case 'guitar':
                synthGuitar(note, now);
                break;
            case 'piano':
                synthPiano(note, now);
                break;
            // Add cases for other instruments as needed
        }
    }

    Tone.Transport.start();
}
    </script>
</body>
</html>
